<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WZYçš„ä¸»é¡µ</title>

    <!-- ç«‹å³åº”ç”¨èƒŒæ™¯ï¼Œé¿å…é—ªçƒ -->
    <script>
        (function() {
            var savedBg = localStorage.getItem('selectedBackground') || 'IMG_E5419.jpeg';
            var bgUrl = savedBg.indexOf('http') === 0 ? savedBg : '../image/fll/system_image/' + savedBg;
            document.write('<style>body{background-image:url("' + bgUrl + '")!important;background-size:cover!important;background-position:center!important;background-attachment:fixed!important;}</style>');
        })();
    </script>

    <link rel="stylesheet" href="../css/nav.css">
    <link rel="stylesheet" href="../css/body.css">
    <link rel="stylesheet" href="../css/Loading.css">
    <link rel="stylesheet" href="../css/homestyle.css">
    <link rel="stylesheet" href="../css/music.css">

    <!-- ç™¾åº¦ç»Ÿè®¡ -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c37b574919c030aba383a1cdcccdc6ef";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>
<body>
    <!-- æ¼‚æµ®ç²’å­ -->
    <div id="particles"></div>

    <!-- éŸ³ç¬¦è£…é¥° -->
    <div id="notes"></div>

    <nav class="homenav">
        <div class="navtitle"><strong>PHROLOVA</strong></div>
        <button class="bg-selector-btn" onclick="openImageSelector()" title="é€‰æ‹©èƒŒæ™¯">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
            </svg>
        </button>
        <button class="music-btn" onclick="toggleMusicPlayer()" title="éŸ³ä¹æ’­æ”¾å™¨">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18V5l12-2v13"></path>
                <circle cx="6" cy="18" r="3"></circle>
                <circle cx="18" cy="16" r="3"></circle>
            </svg>
        </button>
        <a href="home.html">HOME</a>
        <a href="information.html">VIDEO</a>
        <a href="chat.html">CHAT</a>
        <a href="album.html">ALBUM</a>
        <a href="board.html">BOARD</a>
        <div class="navanim home"></div>
        <div class="none"></div>
    </nav>

    <main class="main">
    <section class="sec home-hero">
        <div class="hero-content">
            <h1 class="hero-title">å¼—æ´›æ´›</h1>
            <p class="hero-subtitle">PHROLOVA Â· æŒ½æ­Œ æ°¸ä¸è½å¹•</p>
            <button class="divider-btn" id="dividerBtn" onclick="toggleWallpaperView()">
                <span>â€¢</span>
                <span>+</span>
                <span>+</span>
                <span>â€¢</span>
            </button>
            <p class="hero-quote">æˆ‘æ›¾æ¢¦è§ï¼Œä¸ä½ äº²å¯†æ— é—´<br>é†’æ¥å‘ç°ï¼Œä½ æˆ‘å½¢åŒé™Œè·¯</p>
            <button class="hero-btn" onclick="openImageSelector()">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡ â—‡</button>
        </div>
    </section>

    <!-- å›¾ç‰‡é€‰æ‹©å¼¹çª— -->
    <div id="imageSelector" class="image-selector">
        <div class="selector-content">
            <h2 class="selector-title">é€‰æ‹©ä½ å–œæ¬¢çš„èƒŒæ™¯</h2>
            <div class="image-grid" id="imageGrid"></div>
            <button class="close-btn" onclick="closeImageSelector()">å…³é—­</button>
        </div>
    </div>

    <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
    <div id="musicPlayer" class="music-player">
        <div class="music-header">
            <h3>ğŸµ éŸ³ä¹æ’­æ”¾å™¨</h3>
            <button class="close-music-btn" onclick="toggleMusicPlayer()">Ã—</button>
        </div>
        <div class="music-info">
            <div class="music-cover">
                <img id="musicCover" src="../image/homepic1.png" alt="å°é¢">
            </div>
            <div class="music-details">
                <div class="music-title" id="musicTitle">æœªé€‰æ‹©éŸ³ä¹</div>
                <div class="music-artist" id="musicArtist">-</div>
            </div>
        </div>
        <div class="music-progress">
            <span class="time-current" id="currentTime">0:00</span>
            <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
            <span class="time-total" id="totalTime">0:00</span>
        </div>
        <div class="music-controls">
            <button class="control-btn" id="shuffleBtn" onclick="toggleShuffle()" title="éšæœºæ’­æ”¾">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 3 21 3 21 8"></polyline>
                    <line x1="4" y1="20" x2="21" y2="3"></line>
                    <polyline points="21 16 21 21 16 21"></polyline>
                    <line x1="15" y1="15" x2="21" y2="21"></line>
                    <line x1="4" y1="4" x2="9" y2="9"></line>
                </svg>
            </button>
            <button class="control-btn" onclick="previousTrack()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 6h2v12H6zM10 6l8.5 6l-8.5 6z"/>
                </svg>
            </button>
            <button class="control-btn play-btn" id="playBtn" onclick="togglePlay()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </button>
            <button class="control-btn" onclick="nextTrack()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M5.5 6l8.5 6l-8.5 6V6zM16 6h2v12h-2z"/>
                </svg>
            </button>
            <button class="control-btn" id="loopBtn" onclick="toggleLoop()" title="å•æ›²å¾ªç¯">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 1l4 4-4 4"></path>
                    <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                    <path d="M7 23l-4-4 4-4"></path>
                    <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                    <text x="12" y="16" font-size="10" fill="currentColor" text-anchor="middle" font-weight="bold">1</text>
                </svg>
            </button>
        </div>
        <div class="music-playlist">
            <h4>æ’­æ”¾åˆ—è¡¨</h4>
            <div id="playlistContainer" class="playlist-items">
                <div class="playlist-item" onclick="loadTrack(0)">
                    <span>1. ç¤ºä¾‹æ­Œæ›² 1</span>
                </div>
            </div>
        </div>
    </div>

    <audio id="audioPlayer" preload="metadata"></audio>

    <section class="sec" id="cards-section">
        <a href="information.html">
            <div class="part1 pt">
                <div class="imghid"><div class="img"></div></div>
                <div class="txt">
                    <h1>VIDEO</h1>
                    <p>&emsp;&emsp;æŒ½æ­Œæ°¸ä¸è½å¹•ï¼Œè®°å¿†åœ¨å…‰å½±ä¸­æµè½¬</p>
                    <p>&emsp;&emsp;A visual journey through memories and emotions. Watch the story unfold in moving pictures</p>
                </div>
            </div>
        </a>
        <a href="chat.html">
            <div class="part2 pt">
                <div class="txt">
                    <h1>CHAT</h1>
                    <p>&emsp;ä¸AIå¯¹è¯ï¼Œæ¢ç´¢æ— é™å¯èƒ½</p>
                    <p>&emsp;Engage in conversations with AI. Share thoughts, ask questions, and discover new perspectives</p>
                </div>
                <div class="imghid"><div class="img"></div></div>
            </div>
        </a>
        <a href="album.html">
            <div class="part3 pt">
                <div class="imghid"><div class="img"></div></div>
                <div class="txt">
                    <h1>ALBUM</h1>
                    <p>&emsp;&emsp;çè—æ—¶å…‰çš„ç¢ç‰‡ï¼Œå®šæ ¼ç¾å¥½ç¬é—´</p>
                    <p>&emsp;&emsp;A collection of precious moments frozen in time. Every picture tells a story worth remembering</p>
                </div>
            </div>
        </a>
        <a href="board.html">
            <div class="part4 pt">
                <div class="txt">
                    <h1>BOARD</h1>
                    <p>&emsp;&emsp;ç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œåˆ†äº«ä½ çš„æ•…äº‹</p>
                    <p>&emsp;&emsp;Leave your mark and share your thoughts. A space for connection and meaningful exchanges</p>
                </div>
                <div class="imghid"><div class="img"></div></div>
            </div>
        </a>
    </section>

    </main>

    <script>
        // åˆ›å»ºæ¼‚æµ®ç²’å­
        function createParticles() {
            const container = document.getElementById('particles');
            const count = 15;
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (8 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }

        // åˆ›å»ºéŸ³ç¬¦
        function createNotes() {
            const container = document.getElementById('notes');
            const notes = ['â™ª', 'â™«', 'â™¬'];
            for (let i = 0; i < 10; i++) {
                const note = document.createElement('div');
                note.className = 'note';
                note.textContent = notes[Math.floor(Math.random() * notes.length)];
                note.style.left = Math.random() * 100 + '%';
                note.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(note);
            }
        }

        // åŠ è½½å›¾ç‰‡åˆ—è¡¨ï¼ˆä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼‰
        async function loadImages() {
            return new Promise((resolve) => {
                console.log('âœ… ä½¿ç”¨æœ¬åœ°èƒŒæ™¯å›¾ç‰‡åˆ—è¡¨');
                loadFallbackImages(resolve);
            });
        }

        // æ¸²æŸ“å›¾ç‰‡ç½‘æ ¼
        function renderImageGrid(images) {
            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            images.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';

                // ä½¿ç”¨æ‡’åŠ è½½
                const imgElement = document.createElement('img');
                imgElement.loading = 'lazy';
                imgElement.src = img.url;
                imgElement.alt = `èƒŒæ™¯${index + 1}`;

                item.appendChild(imgElement);
                item.onclick = () => selectImage(img.url, item);
                imageGrid.appendChild(item);
            });
        }

        // å›é€€åˆ°ç¡¬ç¼–ç åˆ—è¡¨ï¼ˆç°åœ¨ä½œä¸ºä¸»è¦åŠ è½½æ–¹å¼ï¼‰
        function loadFallbackImages(resolve) {
            console.log('ğŸ“‹ åŠ è½½æœ¬åœ°èƒŒæ™¯å›¾ç‰‡');

            const fallbackImages = [
                'IMG_E5416.JPG', 'IMG_E5417.jpeg', 'IMG_E5419.jpeg',
                'IMG_E5421-upscaled.png', 'IMG_E5423-upscaled.png',
                'IMG_E5424-upscaled.png', 'IMG_E5426-upscaled.png', 'IMG_E5427-upscaled.png',
                'IMG_E5429-upscaled.png', 'IMG_E5430-upscaled.png', 'IMG_E5431-upscaled.png',
                'IMG_E5432-upscaled.png', 'IMG_E5433-upscaled.png', 'IMG_E5434-upscaled.png'
            ];

            console.log('ğŸ“‹ å›¾ç‰‡æ•°é‡:', fallbackImages.length);

            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            fallbackImages.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';

                const imgElement = document.createElement('img');
                imgElement.loading = 'lazy';
                imgElement.src = `../image/fll/system_image/${img}`;
                imgElement.alt = `èƒŒæ™¯${index + 1}`;

                item.appendChild(imgElement);
                item.onclick = () => selectImage(img, item);
                imageGrid.appendChild(item);
            });

            resolve(fallbackImages);
        }

        // åº”ç”¨èƒŒæ™¯
        function applyBackground(imageUrl) {
            // å¦‚æœæ˜¯å®Œæ•´ URLï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™ä½¿ç”¨æœ¬åœ°è·¯å¾„
            const bgUrl = imageUrl.startsWith('http') ? imageUrl : `../image/fll/system_image/${imageUrl}`;
            document.body.style.setProperty('background-image', `url('${bgUrl}')`, 'important');
            document.body.style.setProperty('background-size', 'cover', 'important');
            document.body.style.setProperty('background-position', 'center', 'important');
            document.body.style.setProperty('background-attachment', 'fixed', 'important');
        }

        // é€‰æ‹©å›¾ç‰‡
        function selectImage(imageUrl, element) {
            // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('selected');
            });
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            element.classList.add('selected');
            // æ›´æ”¹èƒŒæ™¯
            applyBackground(imageUrl);
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('selectedBackground', imageUrl);
        }

        // æ‰“å¼€é€‰æ‹©å™¨
        function openImageSelector() {
            // æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨
            document.getElementById('imageSelector').style.display = 'flex';
        }

        // å…³é—­é€‰æ‹©å™¨
        function closeImageSelector() {
            document.getElementById('imageSelector').style.display = 'none';
        }

        // åˆ‡æ¢å£çº¸æŸ¥çœ‹æ¨¡å¼
        let isWallpaperMode = false;
        let wasMusicPlayerOpen = false; // è®°å½•è¿›å…¥å£çº¸æ¨¡å¼å‰æ’­æ”¾å™¨æ˜¯å¦æ‰“å¼€

        function toggleWallpaperView() {
            const heroContent = document.querySelector('.hero-content');
            const nav = document.querySelector('nav');
            const cardsSection = document.getElementById('cards-section');
            const musicPlayer = document.getElementById('musicPlayer');

            isWallpaperMode = !isWallpaperMode;

            if (isWallpaperMode) {
                // è¿›å…¥å£çº¸æ¨¡å¼ï¼šéšè—æ‰€æœ‰å†…å®¹
                heroContent.classList.add('wallpaper-mode');
                nav.style.transform = 'translateY(-100%)';
                nav.style.opacity = '0';
                cardsSection.style.transform = 'translateY(100vh)';
                cardsSection.style.opacity = '0';
                // è®°å½•æ’­æ”¾å™¨çŠ¶æ€å¹¶å…³é—­
                wasMusicPlayerOpen = musicPlayer.classList.contains('show');
                if (wasMusicPlayerOpen) {
                    musicPlayer.classList.remove('show');
                }
            } else {
                // é€€å‡ºå£çº¸æ¨¡å¼ï¼šæ¢å¤æ‰€æœ‰å†…å®¹
                heroContent.classList.remove('wallpaper-mode');
                nav.style.transform = 'translateY(0)';
                nav.style.opacity = '1';
                cardsSection.style.transform = 'translateY(0)';
                cardsSection.style.opacity = '1';
                // æ¢å¤æ’­æ”¾å™¨çŠ¶æ€
                if (wasMusicPlayerOpen) {
                    musicPlayer.classList.add('show');
                }
            }
        }

        // ====== éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½å·²ç§»è‡³ music-player.js ======

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = async function() {
            createParticles();
            createNotes();

            // åŠ è½½å›¾ç‰‡åˆ—è¡¨
            const images = await loadImages();

            // æ¢å¤ä¸Šæ¬¡é€‰æ‹©çš„èƒŒæ™¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤èƒŒæ™¯
            const savedBg = localStorage.getItem('selectedBackground') || 'IMG_E5419.jpeg';
            applyBackground(savedBg);

            // é«˜äº®é€‰ä¸­çš„å›¾ç‰‡
            setTimeout(() => {
                const items = document.querySelectorAll('.image-item img');
                items.forEach(img => {
                    const imgSrc = img.src;
                    const savedBgUrl = savedBg.startsWith('http') ? savedBg : `../image/fll/system_image/${savedBg}`;

                    // æ¯”è¾ƒ URLï¼ˆå¤„ç†å¯èƒ½çš„æŸ¥è¯¢å‚æ•°ï¼‰
                    if (imgSrc.split('?')[0] === savedBgUrl.split('?')[0] || imgSrc.includes(savedBg)) {
                        img.parentElement.classList.add('selected');
                    }
                });
            }, 100);

            // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
            initMusicPlayer();

            // ç›‘å¬æ»šåŠ¨äº‹ä»¶å·²ç§»é™¤ - èƒŒæ™¯ä¿æŒç»Ÿä¸€ï¼Œä¸å†éšæœºåˆ‡æ¢
        };
    </script>

    <script src="../js/music-player.js"></script>
</body>
</html>
