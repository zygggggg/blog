<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/Loading.css">
    <link rel="stylesheet" href="../css/homestyle.css">
    <link rel="stylesheet" href="../css/body.css">
    <link rel="stylesheet" href="../css/nav.css">
    <title>WZYçš„ä¸»é¡µ</title>
</head>
<body>
    <!-- æ¼‚æµ®ç²’å­ -->
    <div id="particles"></div>

    <!-- éŸ³ç¬¦è£…é¥° -->
    <div id="notes"></div>

    <nav class="homenav">
        <div class="navtitle"><strong>PHROLOVA</strong></div>
        <a href="home.html">HOME</a>
        <a href="information.html">VIDEO</a>
        <a href="chat.html">CHAT</a>
        <a href="album.html">ALBUM</a>
        <a href="board.html">BOARD</a>
        <div class="navanim home"></div>
        <div class="none"></div>
    </nav>

    <main class="main">
    <section class="sec home-hero">
        <div class="hero-content">
            <h1 class="hero-title">å¼—æ´›æ´›</h1>
            <p class="hero-subtitle">PHROLOVA Â· æŒ½æ­Œ æ°¸ä¸è½å¹•</p>
            <button class="divider-btn" id="dividerBtn" onclick="toggleWallpaperView()">
                <span>â€¢</span>
                <span>+</span>
                <span>+</span>
                <span>â€¢</span>
            </button>
            <p class="hero-quote">æˆ‘æ›¾æ¢¦è§ï¼Œä¸ä½ äº²å¯†æ— é—´<br>é†’æ¥å‘ç°ï¼Œä½ æˆ‘å½¢åŒé™Œè·¯</p>
            <button class="hero-btn" onclick="openImageSelector()">é€‰æ‹©èƒŒæ™¯å›¾ç‰‡ â—‡</button>
        </div>
    </section>

    <!-- å›¾ç‰‡é€‰æ‹©å¼¹çª— -->
    <div id="imageSelector" class="image-selector">
        <div class="selector-content">
            <h2 class="selector-title">é€‰æ‹©ä½ å–œæ¬¢çš„èƒŒæ™¯</h2>
            <div class="image-grid" id="imageGrid"></div>
            <button class="close-btn" onclick="closeImageSelector()">å…³é—­</button>
        </div>
    </div>

    <section class="sec" id="cards-section">
        <a href="information.html">
            <div class="part1 pt">
                <div class="imghid"><div class="img"></div></div>
                <div class="txt">
                    <h1>VIDEO</h1>
                    <p>&emsp;&emsp;æŒ½æ­Œæ°¸ä¸è½å¹•ï¼Œè®°å¿†åœ¨å…‰å½±ä¸­æµè½¬</p>
                    <p>&emsp;&emsp;A visual journey through memories and emotions. Watch the story unfold in moving pictures</p>
                </div>
            </div>
        </a>
        <a href="chat.html">
            <div class="part2 pt">
                <div class="txt">
                    <h1>CHAT</h1>
                    <p>&emsp;ä¸AIå¯¹è¯ï¼Œæ¢ç´¢æ— é™å¯èƒ½</p>
                    <p>&emsp;Engage in conversations with AI. Share thoughts, ask questions, and discover new perspectives</p>
                </div>
                <div class="imghid"><div class="img"></div></div>
            </div>
        </a>
        <a href="album.html">
            <div class="part3 pt">
                <div class="imghid"><div class="img"></div></div>
                <div class="txt">
                    <h1>ALBUM</h1>
                    <p>&emsp;&emsp;çè—æ—¶å…‰çš„ç¢ç‰‡ï¼Œå®šæ ¼ç¾å¥½ç¬é—´</p>
                    <p>&emsp;&emsp;A collection of precious moments frozen in time. Every picture tells a story worth remembering</p>
                </div>
            </div>
        </a>
        <a href="board.html">
            <div class="part4 pt">
                <div class="txt">
                    <h1>BOARD</h1>
                    <p>&emsp;&emsp;ç•™ä¸‹ä½ çš„è¶³è¿¹ï¼Œåˆ†äº«ä½ çš„æ•…äº‹</p>
                    <p>&emsp;&emsp;Leave your mark and share your thoughts. A space for connection and meaningful exchanges</p>
                </div>
                <div class="imghid"><div class="img"></div></div>
            </div>
        </a>
    </section>
        <footer class="foot">
            <p>@2025-2026  |  BY:WZY</p>
            <p>ç½‘é¡µç‰ˆæƒå½’WZYæ‰€æœ‰</p>
            <p>æ— é™è¿›æ­¥ Infinite Progress</p>
        </footer>

    </main>

    <script>
        // åˆ›å»ºæ¼‚æµ®ç²’å­
        function createParticles() {
            const container = document.getElementById('particles');
            const count = 15;
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (8 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }

        // åˆ›å»ºéŸ³ç¬¦
        function createNotes() {
            const container = document.getElementById('notes');
            const notes = ['â™ª', 'â™«', 'â™¬'];
            for (let i = 0; i < 10; i++) {
                const note = document.createElement('div');
                note.className = 'note';
                note.textContent = notes[Math.floor(Math.random() * notes.length)];
                note.style.left = Math.random() * 100 + '%';
                note.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(note);
            }
        }

        // å›¾ç‰‡ç¼“å­˜
        let cachedImages = null;
        const CACHE_KEY = 'oss_background_images';
        const CACHE_EXPIRY_KEY = 'oss_background_images_expiry';
        const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24å°æ—¶

        // åŠ è½½å›¾ç‰‡åˆ—è¡¨
        async function loadImages() {
            return new Promise(async (resolve) => {
                try {
                    // æ£€æŸ¥ç¼“å­˜
                    const cachedData = localStorage.getItem(CACHE_KEY);
                    const cacheExpiry = localStorage.getItem(CACHE_EXPIRY_KEY);
                    const now = Date.now();

                    if (cachedData && cacheExpiry && now < parseInt(cacheExpiry)) {
                        console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„èƒŒæ™¯å›¾ç‰‡åˆ—è¡¨');
                        const images = JSON.parse(cachedData);
                        renderImageGrid(images);
                        resolve(images.map(img => img.url));
                        return;
                    }

                    // ä»åç«¯ API è·å– OSS èƒŒæ™¯å›¾ç‰‡åˆ—è¡¨
                    const API_URL = 'https://blog-production-24dd.up.railway.app/api/backgrounds';

                    console.log('ğŸ“¡ æ­£åœ¨ä» API è·å–èƒŒæ™¯å›¾ç‰‡åˆ—è¡¨...');
                    const response = await fetch(API_URL);

                    if (!response.ok) {
                        throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.code === 200 && result.data && result.data.length > 0) {
                        const images = result.data;
                        console.log('âœ… æˆåŠŸä» OSS åŠ è½½èƒŒæ™¯åˆ—è¡¨');
                        console.log('ğŸ“‹ å›¾ç‰‡æ•°é‡:', images.length);

                        // ç¼“å­˜æ•°æ®
                        localStorage.setItem(CACHE_KEY, JSON.stringify(images));
                        localStorage.setItem(CACHE_EXPIRY_KEY, (now + CACHE_DURATION).toString());

                        renderImageGrid(images);

                        // è¿”å› URL æ•°ç»„
                        resolve(images.map(img => img.url));
                    } else {
                        console.warn('âš ï¸  API è¿”å›ç©ºåˆ—è¡¨ï¼Œä½¿ç”¨å¤‡ç”¨å›¾ç‰‡');
                        loadFallbackImages(resolve);
                    }
                } catch (err) {
                    console.error('âŒ ä» API åŠ è½½å¤±è´¥:', err.message);
                    console.warn('âš ï¸  ä½¿ç”¨ç¡¬ç¼–ç çš„å¤‡ç”¨å›¾ç‰‡åˆ—è¡¨');
                    loadFallbackImages(resolve);
                }
            });
        }

        // æ¸²æŸ“å›¾ç‰‡ç½‘æ ¼
        function renderImageGrid(images) {
            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            images.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';

                // ä½¿ç”¨æ‡’åŠ è½½
                const imgElement = document.createElement('img');
                imgElement.loading = 'lazy';
                imgElement.src = img.url;
                imgElement.alt = `èƒŒæ™¯${index + 1}`;

                item.appendChild(imgElement);
                item.onclick = () => selectImage(img.url, item);
                imageGrid.appendChild(item);
            });
        }

        // å›é€€åˆ°ç¡¬ç¼–ç åˆ—è¡¨
        function loadFallbackImages(resolve) {
            console.warn('âš ï¸ ä½¿ç”¨ç¡¬ç¼–ç çš„å¤‡ç”¨å›¾ç‰‡åˆ—è¡¨');

            const fallbackImages = [
                'IMG_E5416.JPG', 'IMG_E5417.jpeg', 'IMG_E5419.jpeg',
                'IMG_E5421-upscaled.png', 'IMG_E5422.JPG', 'IMG_E5423-upscaled.png',
                'IMG_E5424-upscaled.png', 'IMG_E5426-upscaled.png', 'IMG_E5427-upscaled.png',
                'IMG_E5429-upscaled.png', 'IMG_E5430-upscaled.png', 'IMG_E5431-upscaled.png',
                'IMG_E5432-upscaled.png', 'IMG_E5433-upscaled.png', 'IMG_E5434-upscaled.png'
            ];

            console.log('ğŸ“‹ å¤‡ç”¨å›¾ç‰‡æ•°é‡:', fallbackImages.length);

            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            fallbackImages.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'image-item';

                const imgElement = document.createElement('img');
                imgElement.loading = 'lazy';
                imgElement.src = `../image/fll/system_image/${img}`;
                imgElement.alt = `èƒŒæ™¯${index + 1}`;

                item.appendChild(imgElement);
                item.onclick = () => selectImage(img, item);
                imageGrid.appendChild(item);
            });

            resolve(fallbackImages);
        }

        // åº”ç”¨èƒŒæ™¯
        function applyBackground(imageUrl) {
            // å¦‚æœæ˜¯å®Œæ•´ URLï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™ä½¿ç”¨æœ¬åœ°è·¯å¾„
            const bgUrl = imageUrl.startsWith('http') ? imageUrl : `../image/fll/system_image/${imageUrl}`;
            document.body.style.backgroundImage = `url('${bgUrl}')`;
            document.body.style.backgroundSize = 'cover';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundAttachment = 'fixed';
        }

        // é€‰æ‹©å›¾ç‰‡
        function selectImage(imageUrl, element) {
            // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('selected');
            });
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            element.classList.add('selected');
            // æ›´æ”¹èƒŒæ™¯
            applyBackground(imageUrl);
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('selectedBackground', imageUrl);
        }

        // æ‰“å¼€é€‰æ‹©å™¨
        function openImageSelector() {
            document.getElementById('imageSelector').style.display = 'flex';
        }

        // å…³é—­é€‰æ‹©å™¨
        function closeImageSelector() {
            document.getElementById('imageSelector').style.display = 'none';
        }

        // åˆ‡æ¢å£çº¸æŸ¥çœ‹æ¨¡å¼
        let isWallpaperMode = false;
        function toggleWallpaperView() {
            const heroContent = document.querySelector('.hero-content');
            const nav = document.querySelector('nav');
            const cardsSection = document.getElementById('cards-section');
            const footer = document.querySelector('.foot');

            isWallpaperMode = !isWallpaperMode;

            if (isWallpaperMode) {
                // è¿›å…¥å£çº¸æ¨¡å¼ï¼šéšè—æ‰€æœ‰å†…å®¹
                heroContent.classList.add('wallpaper-mode');
                nav.style.transform = 'translateY(-100%)';
                nav.style.opacity = '0';
                cardsSection.style.transform = 'translateY(100vh)';
                cardsSection.style.opacity = '0';
                footer.style.transform = 'translateY(100%)';
                footer.style.opacity = '0';
            } else {
                // é€€å‡ºå£çº¸æ¨¡å¼ï¼šæ¢å¤æ‰€æœ‰å†…å®¹
                heroContent.classList.remove('wallpaper-mode');
                nav.style.transform = 'translateY(0)';
                nav.style.opacity = '1';
                cardsSection.style.transform = 'translateY(0)';
                cardsSection.style.opacity = '1';
                footer.style.transform = 'translateY(0)';
                footer.style.opacity = '1';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = async function() {
            createParticles();
            createNotes();

            // åŠ è½½å›¾ç‰‡åˆ—è¡¨
            const images = await loadImages();

            // æ¢å¤ä¸Šæ¬¡é€‰æ‹©çš„èƒŒæ™¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤èƒŒæ™¯
            const savedBg = localStorage.getItem('selectedBackground') || 'IMG_E5416.JPG';
            applyBackground(savedBg);

            // é«˜äº®é€‰ä¸­çš„å›¾ç‰‡
            setTimeout(() => {
                const items = document.querySelectorAll('.image-item img');
                items.forEach(img => {
                    const imgSrc = img.src;
                    const savedBgUrl = savedBg.startsWith('http') ? savedBg : `../image/fll/system_image/${savedBg}`;

                    // æ¯”è¾ƒ URLï¼ˆå¤„ç†å¯èƒ½çš„æŸ¥è¯¢å‚æ•°ï¼‰
                    if (imgSrc.split('?')[0] === savedBgUrl.split('?')[0] || imgSrc.includes(savedBg)) {
                        img.parentElement.classList.add('selected');
                    }
                });
            }, 100);

            // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œåˆ‡æ¢èƒŒæ™¯
            const mainContainer = document.querySelector('.main');
            const cardsSection = document.getElementById('cards-section');
            let currentSection = 'hero';

            mainContainer.addEventListener('scroll', function() {
                const scrollTop = mainContainer.scrollTop;
                const viewportHeight = window.innerHeight;

                // åˆ¤æ–­æ˜¯å¦æ»šåŠ¨åˆ°ç¬¬äºŒé¡µ
                if (scrollTop > viewportHeight * 0.5 && currentSection === 'hero') {
                    // éšæœºé€‰æ‹©ä¸€å¼ å›¾ç‰‡
                    if (images && images.length > 0) {
                        const randomImage = images[Math.floor(Math.random() * images.length)];
                        applyBackground(randomImage);
                    }
                    currentSection = 'cards';
                } else if (scrollTop < viewportHeight * 0.5 && currentSection === 'cards') {
                    // è¿”å›ç¬¬ä¸€é¡µï¼Œæ¢å¤ä¿å­˜çš„èƒŒæ™¯
                    const savedBg = localStorage.getItem('selectedBackground') || 'IMG_E5416.JPG';
                    applyBackground(savedBg);
                    currentSection = 'hero';
                }
            });
        };
    </script>
</body>
</html>
